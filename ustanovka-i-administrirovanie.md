# Установка и администрирование

## Системные требования

### Требования к программному обеспечению

#### Операционная система

Дистрибутивы СУБД NitrosBase существуют для следующих операционных систем:

* Windows Server 2016 и выше, Windows 10;
* Ubuntu 16.0 и выше.

#### Программные библиотеки

Возможны следующие способы подключения к СУБД NitrosBase:

* через С API,
* через С\# API,
* через ODBC,
* через MS SQL Reporting Services.

Соответствующие библиотеки и драйвера поставляются в составе дистрибутива. На машине с NitrosBase должна быть развернута среда исполнения, необходимая для функционирования этих библиотек.

В отсутствие возможностей использовать какой-либо из указанных способов подключения для выполнения запросов можно использовать утилиту  testsql, также поставляемую в составе дистрибутива.

Более подробно использование программных библиотек описано в документе «NitrosBase. Способы подключения и API».

### Требования к аппаратному обеспечению

Минимальные требования к аппаратному обеспечению:

* Количество ядер процессора — от 4,
* Частота процессора — от 2.0 GHz,
* Объем оперативной памяти — от 16 GB,
* Объем свободного места на жестком диске \(предпочтителен SSD\) — от 128 GB.

## **Установка**

::: tip ЗАМЕЧАНИЕ
Для установки достаточно распаковать архив с дистрибутивом в любой каталог. ПО поставляется как портабельное, функционирование которого не зависит от расположения в структуре каталогов операционной системы.
:::

Дистрибутивы для Windows и Linux почти полностью эквивалентны по структуре и функциональности, за исключением случаев, когда явно оговорено иное.

#### **Структура каталогов**

Распакованный дистрибутив содержит следующие каталоги:

* **bin** — исполняемые файлы сервера и клиента СУБД, часть библиотек;
* **data** — данные для импорта в демонстрационную базу данных;
* **docs** — документация;
* **include** — заголовочные файлы C/C++;
* **lib** — клиентские библиотеки, драйвера;
* **samples.c++** — примеры.

#### Установка ODBC-драйвера под Windows

Windows-дистрибутив содержит драйвер ODBC, отсутствующий в дистрибутиве для Linux. Для установки драйвера ODBC запустите командную строку \(cmd.exe\) от имени администратора, перейдите в каталог bin и запустите файл nb\_odbc\_install.bat.

Для деинсталляции драйвера предназначен скрипт nb\_odbc\_uninstall.bat \(также запускается с правами администратора\).

## **Подготовка демонстрационной БД**

{% hint style="success" %}
Чтобы подготовить демонстрационную БД, нужно запустить два файла сценариев  
\(в Linux следует запускать файлы с тем же именем и расширением .sh вместо .bat\):
{% endhint %}

```text
start runserver.bat
```

В отдельном окне запустится сервер, который в свою очередь создаст новую базу данных sntest1.

```text
sntest_prepare.bat
```

Демонстрационная база будет наполнена данными.

{% hint style="success" %}
Проверку работоспособности можно выполнить с помощью утилиты testsql
{% endhint %}

```text
echo select name,lastname,age from person limit 10 | testsql.exe -m speed -t nb -d sntest1 -H 127.0.0.1 -P 3020 -i -v 
```

## **Сервер NitrosBase**

Сервер NitrosBase — процесс, обслуживающий базу данных и обрабатывающий запросы к ней. Один сервер обслуживает одну базу данных. Для обслуживания нескольких баз данных следует запускать несколько экземпляров сервера.

#### **Синтаксис запуска**

```text
server.exe -c create|open|close -d <dbname> [-p <datapath>]
[-n <cluster_node>] [-m worker|watchdog] [-b] [-P <port>] [-N nodes..]
[-R <restorepath>]

--help или -h      -- эта справка  
    
--command=<action>
 -c <command>  	  -- команда:
                     create - создание новой БД и старт сервера для нее
                     open   - запуск сервера для указанной БД
                     close  - выключение сервера для указанной БД
--dbname=<dbname>
 -d <dbname>   	  -- имя БД, см. также примечания по кластерному режиму

--dbpath=<path>
 -p <path>     	  -- путь к каталогу, содержащему базы данных

--clusternodes=<nodes>
 -N <nodes>       -- (кластерный режим) общее число узлов в кластере

--node=<cluster_node>
 -n <cluster_node> -- (кластерный режим)
                      номер узла в кластере (от 0 до cluster_nodes-1);
                      этот номер узла добавляется в конец названия БД,
                      указанного в параметре <dbname>;
                      например, при -n 1 -d dbfoo имя БД будет dbfoo1.
--mode=<mode>
 -m <mode>     	  -- режим работы:
                     supervisor - режим watchdog’a, перезапускающего
                     сервер при падении (режим выбирается по умолчанию)
                     worker - одиночный worker, обслуживает одну БД
--background
 -b            	  -- запуск процесса в фоновом режиме

--port=<port>
 -P <port>     	  -- TCP-порт, который слушает сервер

--restorepath=<restorepath>
 -R <restorepath> -- путь к каталогу резервных копий
```

Таким образом, сервер имеет три команды \(create, open, close\) и два режима:

* режим supervisor — сторожевой процесс перезапускает упавший сервер; рекомендуется использовать в промышленной эксплуатации.
* режим worker -- обычный режим обслуживания БД; для тестирования.

## **Клиент NitrosBase**

В качестве клиента используется testsql \(может являться клиентом и других СУБД\).

#### **Синтаксис запуска**

```text
testsql -h

testsql -m compare
-t dbtype1
(-c connstr1|-d dbname1 -h host1 -u user1 -p pw1 -P port1)
-t dbtype2
(-c connstr2|-d dbname2 -h host2 -u user2 -p pw2 -P port2)
(-q query|-i) [-v]

testsql -m speed|shell
-t dbtype
(-c connstr|-d dbname -h host -u user -p pw -P port)
(-q query|-i) [-v]

-h                      -- вывод краткой справки

-m compare|speed|shell  -- режим:
      compare - сравнение выполнения запросов
                на различных СУБД
      speed   - профилировка скорости выполнения запроса
      shell   - интерактивный режим выполнения запросов

-t odbc|mysql|pgsql|nb  -- тип СУБД, "nb" для NitrosBase

-d dbname               -- имя базы данных
-H hostname             -- имя узла сервера БД
-u username             -- имя пользователя сервера БД
-p password             -- пароль пользователя сервера БД
-P port                 -- TCP-порт сервера БД
-c <connstr>            -- строка соединения; вместо набора -H -u -p -P -d
-q <query>              -- SQL запрос для выполнения
-n <iterations>         -- выполнение SQL-запроса N раз
-i                      -- чтение SQL-запроса со стандартного ввода
-v                      -- вывод результатов запроса; всегда включен
                           для режимов -m compare и -m shell.
```

